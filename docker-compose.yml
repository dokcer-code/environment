version: '3'
services:
    nginx:
        build:
            context: docker/build/nginx
        volumes:
            - /var/www/vse-avtoservisy.ru/app/web:/var/www/vse-avtoservisy.ru/app/web
        networks:
            self:
                ipv4_address: ${NGINX_HOST}
    php-7.1:
        build:
            context: docker/build/php-7.1/
        networks:
            self:
                ipv4_address: ${PHP_7_1_HOST}
        user: "1000"
        environment:
            CLIENT_HOST: ${CLIENT_HOST}
            COMPOSER_HOME: '/tmp/composer'
        volumes:
            - /var/www/salonrk:/var/www/salonrk
            - /var/www/vse-avtoservisy.ru:/var/www/vse-avtoservisy.ru
            #- /var/www/bien:/var/www/bien
            #- /var/www/cabinet:/var/www/cabinet
            #- /var/www/service_network:/var/www/service_network
            #- /var/www/service_network_2:/var/www/service_network_2
            #- /var/www/service_network_3:/var/www/service_network_3
            #- /var/www/spare_network:/var/www/spare_network
        working_dir: /var/www
        extra_hosts:
            - "avto-servisy.loc:${CLIENT_HOST}"
    php-7.2:
        build:
            context: docker/build/php-7.2/
        networks:
            self:
                ipv4_address: ${PHP_7_2_HOST}
        # volumes:
            # - /var/www/bien:/var/www/bien
            #- /var/www/cabinet:/var/www/cabinet
            #- /var/www/service_network:/var/www/service_network
            #- /var/www/service_network_2:/var/www/service_network_2
            #- /var/www/service_network_3:/var/www/service_network_3
            #- /var/www/spare_network:/var/www/spare_network
    php-7.3:
        build:
            context: docker/build/php-7.3/
        user: "1000"
        volumes:
            - /var/www/laravel:/var/www/laravel
            - /var/www/service_network:/var/www/service_network
        networks:
            self:
                ipv4_address: ${PHP_7_3_HOST}
        working_dir: /var/www/
    mysql-8:
        image: mysql:8
        volumes:
            - ./docker/server/mysql-8:/var/lib/mysql
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
        networks:
            self:
                ipv4_address: ${MYSQL_8_HOST}
    mysql-5.7:
        image: mysql:5.7
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
        volumes:
            - ./docker/server/mysql-5.7:/var/lib/mysql
        networks:
            self:
                ipv4_address: ${MYSQL_5_7_HOST}
    mysql-5.6:
        image: mysql:5.6
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: 'true'
        volumes:
            - ./docker/server/mysql-5.6:/var/lib/mysql
        networks:
            self:
                ipv4_address: ${MYSQL_5_6_HOST}
networks:
    self:
        driver: bridge
        ipam: 
            config:
                - subnet: ${NETWORK_SUBNET}            
